# This Source Code Form is subject to the terms of the Mozilla Public
# License, v. 2.0. If a copy of the MPL was not distributed with this
# file, You can obtain one at http://mozilla.org/MPL/2.0/.
transforms:
  - env
  - secrets
config:
  capacity:         1
  credentials:
    # Create a client with the scope:
    # assume:project:taskcluster:worker-test-scopes
    # secrets:get:project/taskcluster/taskcluster-worker/stateless-dns
    clientId:       <%= @taskcluster_client_id %>
    accessToken:    <%= @taskcluster_access_token %>
  provisionerId:    releng-hardware
  workerType :      <%= @taskcluster_worker_type %>
  workerGroup:      <%= @taskcluster_worker_group %>
  workerId:         <%= @hostname %>
  engine:           native
  engines:
    native:
      createUser: false
  logLevel:         info
  plugins:
<% if @operatingsystem == 'Darwin' -%>
    disabled:       ['interactive', 'maxruntime']
    reboot:
      rebootAfter: 96 # hours
      rebootCommand: ['/usr/bin/sudo', '/sbin/reboot']
    env:
      extra:
        TMPDIR: {$env: TMPDIR}
        SHELL: '/bin/bash'
        LANG: 'en_US.UTF-8'
        LC_ALL: 'en_US.UTF-8'
        XPC_FLAGS: '0x0'
        XPC_SERVICE_NAME: '0'
        PATH: "/usr/local/bin:/usr/bin:/bin:/usr/sbin:/sbin"
<% else -%>
    disabled:       ['interactive', 'maxruntime', 'env']
    reboot:
      rebootAfter: 96 # hours
      rebootCommand: ['/usr/bin/sudo', '/sbin/reboot']
<% end -%>
  pollingInterval:  10
  queueBaseUrl:     https://queue.taskcluster.net/v1
  reclaimOffset:    120
  temporaryFolder:  /var/tmp/tc-worker-tmp
  serverIp:           127.0.0.1
  serverPort:         60000
  tlsCertificiate:
    $secret:  project/taskcluster/taskcluster-worker/stateless-dns
    key:      certificate
  tlsKey:
    $secret:  project/taskcluster/taskcluster-worker/stateless-dns
    key:      tlsKey
  statelessDNSSecret:
    $secret:  project/taskcluster/taskcluster-worker/stateless-dns
    key:      secret
  statelessDNSDomain:
    $secret:  project/taskcluster/taskcluster-worker/stateless-dns
    key:      domain
  maxLifeCycle:       600
  minimumDiskSpace:   10000000  # 10 GB
  minimumMemory:      1000000   # 1 GB
