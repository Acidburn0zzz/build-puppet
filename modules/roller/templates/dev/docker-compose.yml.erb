version: '2'

services:
  redis:
    image: redis:3.2

  base:
    image: "mozilla/relops-hardware-controller:<%= @image_tag %>"
    environment:
      - DJANGO_CONFIGURATION=Dev
    env_file:
      - .env
    volumes:
      - /opt/rollerdev:/app

  web:
    extends:
      service: base
    depends_on:
      - redis
    ports:
      - "<%= @port %>:<%= @port %>"
    links:
      - redis
    command: web-dev

  watch-worker:
    extends:
      service: base
    links:
      - redis
    command: watch-worker-purge
